{"version":3,"sources":["/node_modules/browser-pack/_prelude.js","/src/CompressedImage.js","/src/CompressedTextureManager.js","/src/GLTextureMixin.js","/src/extensionChooser.js","/src/extensionFixer.js","/src/imageParser.js","/src/index.js"],"names":["f","exports","module","define","amd","g","window","global","self","this","pixiCompressedTextures","min","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length","1","CompressedImage","src","data","type","width","height","levels","internalFormat","prototype","init","apply","arguments","fourCCToInt32","value","charCodeAt","int32ToFourCC","String","fromCharCode","textureLevelSize","format","COMPRESSED_RGB_S3TC_DXT1_EXT","COMPRESSED_RGB_ATC_WEBGL","COMPRESSED_RGB_ETC1_WEBGL","COMPRESSED_RGBA_S3TC_DXT3_EXT","COMPRESSED_RGBA_S3TC_DXT5_EXT","COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL","COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL","COMPRESSED_RGB_PVRTC_4BPPV1_IMG","COMPRESSED_RGBA_PVRTC_4BPPV1_IMG","Math","floor","max","COMPRESSED_RGB_PVRTC_2BPPV1_IMG","COMPRESSED_RGBA_PVRTC_2BPPV1_IMG","isCompressedImage","oldComplete","complete","onload","target","dispose","generateWebGLTexture","gl","preserveSource","offset","levelSize","dxtLevel","Uint8Array","buffer","byteOffset","compressedTexImage2D","TEXTURE_2D","texParameteri","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","LINEAR_MIPMAP_NEAREST","loadFromArrayBuffer","arrayBuffer","head","_loadDDS","_loadPVR","header","Int32Array","DDS_HEADER_LENGTH","DDS_HEADER_MAGIC","DDS_MAGIC","DDS_HEADER_PF_FLAGS","DDPF_FOURCC","fourCC","DDS_HEADER_PF_FOURCC","FOURCC_DXT1","FOURCC_DXT3","FOURCC_DXT5","FOURCC_ATC","FOURCC_ATCA","FOURCC_ATCI","DDS_HEADER_FLAGS","DDSD_MIPMAPCOUNT","DDS_HEADER_MIPMAPCOUNT","DDS_HEADER_WIDTH","DDS_HEADER_HEIGHT","dataOffset","DDS_HEADER_SIZE","dxtData","PVR_HEADER_LENGTH","PVR_HEADER_MAGIC","PVR_MAGIC","PVR_HEADER_FORMAT","PVR_FORMAT_2BPP_RGB","PVR_FORMAT_2BPP_RGBA","PVR_FORMAT_4BPP_RGB","PVR_FORMAT_4BPP_RGBA","PVR_FORMAT_ETC1","PVR_FORMAT_DXT1","PVR_FORMAT_DXT3","PVR_FORMAT_DXT5","PVR_HEADER_WIDTH","PVR_HEADER_HEIGHT","PVR_HEADER_MIPMAPCOUNT","PVR_HEADER_METADATA","pvrtcData","CompressedTextureManager","renderer","WebGLManager","core","PIXI","Object","create","constructor","WebGLRenderer","registerPlugin","getSupportedExtensions","getExtension","name","vendorPrefixes","ext","dxt","pvrtc","atc","GLTexture","glCore","GLTextureMixin","uploadNotCompressed","upload","isCompressed","source","bind","pixelStorei","UNPACK_PREMULTIPLY_ALPHA_WEBGL","premultiplyAlpha","enableMipmap","mipmap","generateMipmap","extensionChooser","supportedExtensions","imageParser","resource","next","metadata","choice","url","_defaultUrlChoice","k","lastIndexOf","_baseUrl","substring","j","loadType","_determineLoadType","textureExtensionFixer","texture","_defaultUrl","baseTexture","utils","BaseTextureCache","imageUrl","TextureCache","indexOf","compressedImage","onComplete","add","Resource","TYPE","IMAGE","loaders","setExtensionXhrType","XHR_RESPONSE_TYPE","BUFFER","plugin","extensionFixer","detectExtensions","resolution","extensions","plugins","compressedTextureManager","push","CanvasRenderer","res","slice","pop","assign","Loader","addPixiMiddleware","loader","use","compressedTextures"],"mappings":"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","file":"pixi-compressed-textures.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","function CompressedImage(src, data, type, width, height, levels, internalFormat) {\n    CompressedImage.prototype.init.apply(this, arguments);\n}\n\nmodule.exports = CompressedImage;\n\nCompressedImage.prototype.init = function(src, data, type, width, height, levels, internalFormat) {\n    this.src = src;\n    this.width = width;\n    this.height = height;\n    this.data = data;\n    this.type = type;\n    this.levels = levels;\n    this.internalFormat = internalFormat;\n    this.isCompressedImage = true;\n\n    var oldComplete = this.complete;\n    this.complete = !!data;\n    if (!oldComplete && this.complete && this.onload) {\n        this.onload( { target: this } );\n    }\n    return this;\n};\n\nCompressedImage.prototype.dispose = function() {\n    this.data = null;\n};\n\nCompressedImage.prototype.generateWebGLTexture = function (gl, preserveSource) {\n    if (this.data === null) {\n        throw \"Trying to create a second (or more) webgl texture from the same CompressedImage : \" + this.src;\n    }\n\n    var width = this.width;\n    var height = this.height;\n    var levels = this.levels;\n    var offset = 0;\n    // Loop through each mip level of compressed texture data provided and upload it to the given texture.\n    for (var i = 0; i < this.levels; ++i) {\n        // Determine how big this level of compressed texture data is in bytes.\n        var levelSize = textureLevelSize(this.internalFormat, width, height);\n        // Get a view of the bytes for this level of DXT data.\n        var dxtLevel = new Uint8Array(this.data.buffer, this.data.byteOffset + offset, levelSize);\n        // Upload!\n        gl.compressedTexImage2D(gl.TEXTURE_2D, i, this.internalFormat, width, height, 0, dxtLevel);\n        // The next mip level will be half the height and width of this one.\n        width = width >> 1;\n        if (width < 1)\n            width = 1;\n        height = height >> 1;\n        if (height < 1)\n            height = 1;\n        // Advance the offset into the compressed texture data past the current mip level's data.\n        offset += levelSize;\n    }\n\n    // We can't use gl.generateMipmaps with compressed textures, so only use\n    // mipmapped filtering if the compressed texture data contained mip levels.\n    if (levels > 1) {\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_NEAREST);\n    }\n    else {\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    }\n\n    // Cleaning the data to save memory. NOTE : BECAUSE OF THIS WE CANNOT CREATE TWO GL TEXTURE FROM THE SAME COMPRESSED IMAGE !\n    if (!preserveSource)\n        this.data = null;\n};\n\n/**\n * Load a compressed image from an array buffer\n * @param arrayBuffer the buffer contains the image\n * @return the loaded CompressedImage\n */\nCompressedImage.loadFromArrayBuffer = function (arrayBuffer, src) {\n    return new CompressedImage(src).loadFromArrayBuffer(arrayBuffer);\n};\n\nCompressedImage.prototype.loadFromArrayBuffer = function(arrayBuffer) {\n    var head = new Uint8Array(arrayBuffer, 0, 3);\n\n    //todo: implement onload\n\n    if (head[0] == \"DDS\".charCodeAt(0) && head[1] == \"DDS\".charCodeAt(1) && head[2] == \"DDS\".charCodeAt(2))\n        return this._loadDDS(arrayBuffer);\n    else if (head[0] == \"PVR\".charCodeAt(0) && head[1] == \"PVR\".charCodeAt(1) && head[2] == \"PVR\".charCodeAt(2))\n        return this._loadPVR(arrayBuffer);\n    else\n        throw \"Compressed texture format is not recognized: \" + src;\n    return this;\n};\n\n/**\n * Load a DDS compressed image from an array buffer\n * @param arrayBuffer the buffer contains the image\n * @return the loaded CompressedImage\n */\nCompressedImage.prototype._loadDDS = function(arrayBuffer) {\n    // Get a view of the arrayBuffer that represents the DDS header.\n    var header = new Int32Array(arrayBuffer, 0, DDS_HEADER_LENGTH);\n\n    // Do some sanity checks to make sure this is a valid DDS file.\n    if (header[DDS_HEADER_MAGIC] != DDS_MAGIC)\n        throw \"Invalid magic number in DDS header\";\n\n    if (!header[DDS_HEADER_PF_FLAGS] & DDPF_FOURCC)\n        throw \"Unsupported format, must contain a FourCC code\";\n\n    // Determine what type of compressed data the file contains.\n    var fourCC = header[DDS_HEADER_PF_FOURCC];\n    var internalFormat;\n    switch (fourCC) {\n        case FOURCC_DXT1:\n            internalFormat = COMPRESSED_RGB_S3TC_DXT1_EXT;\n            break;\n        case FOURCC_DXT3:\n            internalFormat = COMPRESSED_RGBA_S3TC_DXT3_EXT;\n            break;\n        case FOURCC_DXT5:\n            internalFormat = COMPRESSED_RGBA_S3TC_DXT5_EXT;\n            break;\n        case FOURCC_ATC:\n            internalFormat = COMPRESSED_RGB_ATC_WEBGL;\n            break;\n        case FOURCC_ATCA:\n            internalFormat = COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL;\n            break;\n        case FOURCC_ATCI:\n            internalFormat = COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL;\n            break;\n        default:\n            throw \"Unsupported FourCC code: \" + int32ToFourCC(fourCC);\n    }\n\n    // Determine how many mipmap levels the file contains.\n    var levels = 1;\n    if (header[DDS_HEADER_FLAGS] & DDSD_MIPMAPCOUNT) {\n        levels = Math.max(1, header[DDS_HEADER_MIPMAPCOUNT]);\n    }\n\n    // Gather other basic metrics and a view of the raw the DXT data.\n    var width = header[DDS_HEADER_WIDTH];\n    var height = header[DDS_HEADER_HEIGHT];\n    var dataOffset = header[DDS_HEADER_SIZE] + 4;\n    var dxtData = new Uint8Array(arrayBuffer, dataOffset);\n\n    return this.init(this.src, dxtData, 'DDS', width, height, levels, internalFormat);\n};\n\n/**\n * Load a PVR compressed image from an array buffer\n * @param arrayBuffer the buffer contains the image\n * @return the loaded CompressedImage\n */\nCompressedImage.prototype._loadPVR = function(arrayBuffer) {\n    // Get a view of the arrayBuffer that represents the DDS header.\n    var header = new Int32Array(arrayBuffer, 0, PVR_HEADER_LENGTH);\n\n    // Do some sanity checks to make sure this is a valid DDS file.\n    if (header[PVR_HEADER_MAGIC] != PVR_MAGIC)\n        throw \"Invalid magic number in PVR header\";\n\n    // Determine what type of compressed data the file contains.\n    var format = header[PVR_HEADER_FORMAT];\n    var internalFormat;\n    switch (format) {\n        case PVR_FORMAT_2BPP_RGB:\n            internalFormat = COMPRESSED_RGB_PVRTC_2BPPV1_IMG;\n            break;\n        case PVR_FORMAT_2BPP_RGBA:\n            internalFormat = COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;\n            break;\n        case PVR_FORMAT_4BPP_RGB:\n            internalFormat = COMPRESSED_RGB_PVRTC_4BPPV1_IMG;\n            break;\n        case PVR_FORMAT_4BPP_RGBA:\n            internalFormat = COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;\n            break;\n        case PVR_FORMAT_ETC1:\n            internalFormat = COMPRESSED_RGB_ETC1_WEBGL;\n            break;\n        case PVR_FORMAT_DXT1:\n            internalFormat = COMPRESSED_RGB_S3TC_DXT1_EXT;\n            break;\n        case PVR_FORMAT_DXT3:\n            internalFormat = COMPRESSED_RGBA_S3TC_DXT3_EXT;\n            break;\n        case PVR_FORMAT_DXT5:\n            internalFormat = COMPRESSED_RGBA_S3TC_DXT5_EXT;\n            break;\n        default:\n            throw \"Unsupported PVR format: \" + format;\n    }\n\n    // Gather other basic metrics and a view of the raw the DXT data.\n    var width = header[PVR_HEADER_WIDTH];\n    var height = header[PVR_HEADER_HEIGHT];\n    var levels = header[PVR_HEADER_MIPMAPCOUNT];\n    var dataOffset = header[PVR_HEADER_METADATA] + 52;\n    var pvrtcData = new Uint8Array(arrayBuffer, dataOffset);\n\n    return this.init(this.src, pvrtcData, 'PVR', width, height, levels, internalFormat);\n};\n\n\n//============================//\n// DXT constants and utilites //\n//============================//\n\n// Utility functions\n// Builds a numeric code for a given fourCC string\nfunction fourCCToInt32(value) {\n    return value.charCodeAt(0) +\n        (value.charCodeAt(1) << 8) +\n        (value.charCodeAt(2) << 16) +\n        (value.charCodeAt(3) << 24);\n}\n\n// Turns a fourCC numeric code into a string\nfunction int32ToFourCC(value) {\n    return String.fromCharCode(\n        value & 0xff,\n        (value >> 8) & 0xff,\n        (value >> 16) & 0xff,\n        (value >> 24) & 0xff\n    );\n}\n\n// Calcualates the size of a compressed texture level in bytes\nfunction textureLevelSize(format, width, height) {\n    switch (format) {\n        case COMPRESSED_RGB_S3TC_DXT1_EXT:\n        case COMPRESSED_RGB_ATC_WEBGL:\n        case COMPRESSED_RGB_ETC1_WEBGL:\n            return ((width + 3) >> 2) * ((height + 3) >> 2) * 8;\n\n        case COMPRESSED_RGBA_S3TC_DXT3_EXT:\n        case COMPRESSED_RGBA_S3TC_DXT5_EXT:\n        case COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:\n        case COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:\n            return ((width + 3) >> 2) * ((height + 3) >> 2) * 16;\n\n        case COMPRESSED_RGB_PVRTC_4BPPV1_IMG:\n        case COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:\n            return Math.floor((Math.max(width, 8) * Math.max(height, 8) * 4 + 7) / 8);\n\n        case COMPRESSED_RGB_PVRTC_2BPPV1_IMG:\n        case COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:\n            return Math.floor((Math.max(width, 16) * Math.max(height, 8) * 2 + 7) / 8);\n\n        default:\n            return 0;\n    }\n}\n\n// DXT formats, from:\n// http://www.khronos.org/registry/webgl/extensions/WEBGL_compressed_texture_s3tc/\nvar COMPRESSED_RGB_S3TC_DXT1_EXT = 0x83F0;\nvar COMPRESSED_RGBA_S3TC_DXT1_EXT = 0x83F1;\nvar COMPRESSED_RGBA_S3TC_DXT3_EXT = 0x83F2;\nvar COMPRESSED_RGBA_S3TC_DXT5_EXT = 0x83F3;\n\n// ATC formats, from:\n// http://www.khronos.org/registry/webgl/extensions/WEBGL_compressed_texture_atc/\nvar COMPRESSED_RGB_ATC_WEBGL = 0x8C92;\nvar COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL = 0x8C93;\nvar COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL = 0x87EE;\n\n// DXT values and structures referenced from:\n// http://msdn.microsoft.com/en-us/library/bb943991.aspx/\nvar DDS_MAGIC = 0x20534444;\nvar DDSD_MIPMAPCOUNT = 0x20000;\nvar DDPF_FOURCC = 0x4;\n\nvar DDS_HEADER_LENGTH = 31; // The header length in 32 bit ints.\n\n// Offsets into the header array.\nvar DDS_HEADER_MAGIC = 0;\n\nvar DDS_HEADER_SIZE = 1;\nvar DDS_HEADER_FLAGS = 2;\nvar DDS_HEADER_HEIGHT = 3;\nvar DDS_HEADER_WIDTH = 4;\n\nvar DDS_HEADER_MIPMAPCOUNT = 7;\n\nvar DDS_HEADER_PF_FLAGS = 20;\nvar DDS_HEADER_PF_FOURCC = 21;\n\n// FourCC format identifiers.\nvar FOURCC_DXT1 = fourCCToInt32(\"DXT1\");\nvar FOURCC_DXT3 = fourCCToInt32(\"DXT3\");\nvar FOURCC_DXT5 = fourCCToInt32(\"DXT5\");\n\nvar FOURCC_ATC = fourCCToInt32(\"ATC \");\nvar FOURCC_ATCA = fourCCToInt32(\"ATCA\");\nvar FOURCC_ATCI = fourCCToInt32(\"ATCI\");\n\n//===============//\n// PVR constants //\n//===============//\n\n// PVR formats, from:\n// http://www.khronos.org/registry/webgl/extensions/WEBGL_compressed_texture_pvrtc/\nvar COMPRESSED_RGB_PVRTC_4BPPV1_IMG = 0x8C00;\nvar COMPRESSED_RGB_PVRTC_2BPPV1_IMG = 0x8C01;\nvar COMPRESSED_RGBA_PVRTC_4BPPV1_IMG = 0x8C02;\nvar COMPRESSED_RGBA_PVRTC_2BPPV1_IMG = 0x8C03;\n\n// ETC1 format, from:\n// http://www.khronos.org/registry/webgl/extensions/WEBGL_compressed_texture_etc1/\nvar COMPRESSED_RGB_ETC1_WEBGL = 0x8D64;\n\nvar PVR_FORMAT_2BPP_RGB = 0;\nvar PVR_FORMAT_2BPP_RGBA = 1;\nvar PVR_FORMAT_4BPP_RGB = 2;\nvar PVR_FORMAT_4BPP_RGBA = 3;\nvar PVR_FORMAT_ETC1 = 6;\nvar PVR_FORMAT_DXT1 = 7;\nvar PVR_FORMAT_DXT3 = 9;\nvar PVR_FORMAT_DXT5 = 5;\n\nvar PVR_HEADER_LENGTH = 13; // The header length in 32 bit ints.\nvar PVR_MAGIC = 0x03525650; //0x50565203;\n\n// Offsets into the header array.\nvar PVR_HEADER_MAGIC = 0;\nvar PVR_HEADER_FORMAT = 2;\nvar PVR_HEADER_HEIGHT = 6;\nvar PVR_HEADER_WIDTH = 7;\nvar PVR_HEADER_MIPMAPCOUNT = 11;\nvar PVR_HEADER_METADATA = 12;\n","/**\n * Created by Liza on 12.12.2015.\n */\n\nvar core = PIXI,\n    CompressedImage = require('./CompressedImage'),\n    WebGLManager = core.WebGLManager;\n/**\n * @class\n * @memberof PIXI.compressedTextures\n * @extends PIXI.WebGlManager\n * @param renderer {PIXI.WebGLRenderer} The renderer this manager works for.\n */\nfunction CompressedTextureManager(renderer) {\n    WebGLManager.call(this, renderer);\n}\n\nCompressedTextureManager.prototype = Object.create(WebGLManager.prototype);\nCompressedTextureManager.prototype.constructor = CompressedTextureManager;\nmodule.exports = CompressedTextureManager;\n\ncore.WebGLRenderer.registerPlugin('compressedTextureManager', CompressedTextureManager);\n\nCompressedTextureManager.prototype.getSupportedExtensions = function () {\n    var gl = this.renderer.gl;\n    function getExtension(gl, name) {\n        var vendorPrefixes = [\"\", \"WEBKIT_\", \"MOZ_\"];\n        var ext = null;\n        for (var i in vendorPrefixes) {\n            ext = gl.getExtension(vendorPrefixes[i] + name);\n            if (ext) {\n                break;\n            }\n        }\n        return ext;\n    }\n\n    return {\n        dxt: getExtension(gl, \"WEBGL_compressed_texture_s3tc\"),\n        pvrtc: getExtension(gl, \"WEBGL_compressed_texture_pvrtc\"),\n        atc: getExtension(gl, \"WEBGL_compressed_texture_atc\")\n    };\n};\n","var CompressedImage = require('./CompressedImage');\nvar GLTexture = PIXI.glCore.GLTexture;\n\n/**\n * @mixin\n */\nvar GLTextureMixin = {\n    uploadNotCompressed: GLTexture.prototype.upload,\n    isCompressed: false,\n    upload: function(source)\n    {   \n        if (!(source instanceof CompressedImage)) {\n            return this.uploadNotCompressed(source);\n        }\n        this.bind();\n\n        var gl = this.gl;\n\n        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, this.premultiplyAlpha);\n\n        this.isCompressed = true;\n\n        source.generateWebGLTexture(gl, true);\n    },\n\n    enableMipmap: function() {\n        if (this.isCompressed) {\n            return;\n        }\n        var gl = this.gl;\n\n        this.bind();\n\n        this.mipmap = true;\n\n        gl.generateMipmap(gl.TEXTURE_2D);\n    }\n};\n\nmodule.exports = GLTextureMixin;\n","function extensionChooser(supportedExtensions) {\n    supportedExtensions = supportedExtensions || [];\n\n    var imageParser = require('./imageParser')();\n\n    return function (resource, next) {\n        var ext = resource.metadata.choice;\n        if (!ext) {\n            return next();\n        }\n        //let us choose extension!\n        var url = resource.url;\n        if (!resource._defaultUrlChoice) {\n            resource._defaultUrlChoice = url;\n            var k = url.lastIndexOf(\".\");\n            if (k >= 0) {\n                resource._baseUrl = url.substring(0, k);\n            } else {\n                return next();\n            }\n        }\n        for (var i = ext.length - 1; i >= 0; i--) {\n            url = resource._baseUrl + ext[i];\n            var isSupported = false;\n            for (var j = 0; j < supportedExtensions.length; j++) {\n                if (ext[i] === supportedExtensions[j]) {\n                    resource.url = url;\n                    resource.loadType = resource._determineLoadType();\n                    return imageParser(resource, next);\n                }\n            }\n        }\n        return imageParser(resource, next);\n    };\n}\n\nmodule.exports = extensionChooser;\n","var core = PIXI,\n    utils = core.utils,\n    extensionFixer = require('./CompressedImage');\n\nfunction textureExtensionFixer(supportedExtensions) {\n    return function (resource, next) {\n        if (resource.texture && resource._defaultUrlChoice && resource._defaultUrl != resource.url) {\n            var texture = resource.texture;\n            var baseTexture = texture.baseTexture;\n            delete utils.BaseTextureCache[baseTexture.imageUrl];\n            delete utils.TextureCache[baseTexture.imageUrl];\n            baseTexture.imageUrl = resource._defaultUrlChoice;\n            core.utils.BaseTextureCache[baseTexture.imageUrl] = baseTexture;\n            core.utils.TextureCache[baseTexture.imageUrl] = texture;\n        }\n        next();\n    };\n}\n\nmodule.exports = textureExtensionFixer;\n","var core = PIXI,\n    utils = core.utils,\n    CompressedImage = require('./CompressedImage'),\n    Resource = core.loaders.Resource;\n\nResource.setExtensionXhrType('dds', Resource.XHR_RESPONSE_TYPE.BUFFER);\nResource.setExtensionXhrType('pvr', Resource.XHR_RESPONSE_TYPE.BUFFER);\nResource.setExtensionXhrType('etc1', Resource.XHR_RESPONSE_TYPE.BUFFER);\n\nfunction imageParser() {\n    return function (resource, next) {\n        if (resource.url.indexOf('.dds') != -1 || resource.url.indexOf('.pvr') != -1 || resource.url.indexOf('.etc1') != -1) {\n            var compressedImage = resource.compressedImage || new CompressedImage(resource.url);\n            if (resource.data) {\n                throw \"compressedImageParser middleware must be specified in loader.before() and must have zero resource.data\";\n            }\n            resource.isCompressedImage = true;\n            resource.data = compressedImage;\n            resource.onComplete.add(function() {\n                resource.type = Resource.TYPE.IMAGE;\n                compressedImage.loadFromArrayBuffer(resource.data);\n                resource.data = compressedImage;\n            });\n        }\n        next();\n    };\n}\n\nmodule.exports = imageParser;\n","var plugin = {\n    CompressedTextureManager: require('./CompressedTextureManager'),\n    imageParser: require('./imageParser'),\n    extensionChooser: require('./extensionChooser'),\n    extensionFixer: require('./extensionFixer'),\n    GLTextureMixin: require('./GLTextureMixin'),\n    detectExtensions: function (renderer, resolution) {\n        var extensions = [];\n        if (renderer instanceof PIXI.WebGLRenderer) {\n            var data = renderer.plugins.compressedTextureManager.getSupportedExtensions();\n            if (data.dxt) extensions.push('.dds');\n            if (data.pvrtc) extensions.push('.pvr');\n            if (data.atc) extensions.push('.atc');\n        } else if (renderer instanceof PIXI.CanvasRenderer) {\n            //nothing special for canvas\n        }\n        //retina or not\n        resolution = resolution || renderer.resolution;\n        var res = \"@\"+resolution+\"x\";\n        var ext = extensions.slice(0);\n        while (ext.length > 0) {\n            extensions.push(res + ext.pop());\n        }\n        extensions.push(res + \".png\");\n        extensions.push(res + \".jpg\");\n        //atlas support @1x @2x @.5x\n        extensions.push(res + \".json\");\n        extensions.push(res + \".atlas\");\n        return extensions;\n    }\n};\n\nObject.assign(PIXI.glCore.GLTexture.prototype, plugin.GLTextureMixin);\n\nPIXI.loaders.Loader.addPixiMiddleware(plugin.extensionFixer);\nPIXI.loader.use(plugin.extensionFixer());\n\nmodule.exports = global.PIXI.compressedTextures = plugin;\n"],"sourceRoot":"."}